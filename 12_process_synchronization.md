## 12-1. 동기화란
* (프로세스 + 스레드) 동기화
  : 프로세스들의 수행 시기를 맞추는 것
  - 실행 순서 제어
    : 프로세스를 올바른 순서대로 실행하기
  - 상호 배제
    : 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기
* 실행 순서 제어를 위한 동기화(reader writer problem)
  - Writer: Book.txt 파일에 값을 저장하는 프로세스
  - Reader: Book.txt 파일에 저장된 값을 읽어들이는 프로세스
  - 순서: Writer -> Reader
* 상호 배제를 위한 동기화(Bank account problem)
  : 공유가 불가능한 자원의 동시 사용을 피하기 위한 동기화 -> 한 번에 하나의 프로세스만 접근해야 함  
  ![image](https://github.com/a0lim-java/cs/assets/104348646/d7a0516f-ae58-49b2-a842-c839fb27b2b8)  
* 동기화 예제
  - Producer & Consumer problem  
    ![image](https://github.com/a0lim-java/cs/assets/104348646/4339e7ec-c0a8-45b7-905a-cbb5a521e64c)  
    + 동시에 실행하면, 0이 아닌 수 or Error가 됨 <- 공유 자원(총합)에 동시에 접근했기 때문
  - 공유 자원
    : 여러 프로세스/스레드가 공유하는 자원
    + ex. 전역 변수, 파일, 입출력장치, 보조기억장치
  - 임계 구역
    : 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드 영역
    + 임계 구역에 진입하고자 하면, 진입한 프로세스 이외에는 대기해야 함  
    ![image](https://github.com/a0lim-java/cs/assets/104348646/97ec278c-6884-40c3-8731-cb0a5f292399)
  - 레이스 컨디션(race condition)
    : 임계 구역에 동시에 접근하여 자원의 일관성이 깨지는 현상
* 상호 배제를 위한 동기화를 위한 세 가지 원칙
  1. 상호 배제(mutual exclusion)  
     : 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 들어올 수 없다
  2. 진행(progess)  
     : 임계 구역에 어떤 프로세스도 진입하지 않았다면. 진입하고자 하는 프로세스는 들어갈 수 있어야 한다
  3. 유한 대기(bounded waiting)  
     : 한 프로세스가 임계 구역에 진입하고 싶다면, 언젠가는 임계 구역에 들어올 수 있어야 한다

## 12-2. 동기화 기법
* 뮤텍스 락
  - 자물쇠 역할: 프로세스들이 공유하는 전역 변수 lock
  - 임계 구역을 잠그는 역할: acquire 함수
  - 임계 구역의 잠금을 해제하는 역할: release 함수  
    ![image](https://github.com/a0lim-java/cs/assets/104348646/2e7ee51c-2e6e-4665-8893-a7fc6af5d7af)
  - acquire 함수
    + 프로세스가 임계 구역에 진입하기 전에 호출
    + 임계 구역이 잠겨 있다면, 임계구역이 열릴 때까지 임계구역을 반복적으로 확인
  - release 함수
    + 임계 구역에서의 작업이 끝나고 호출
    + 현재 잠긴 임계 구역을 열기(lock을 false로 바꾸기)
  - 바쁜 대기(busy waiting)
    : 임계 구역이 잠겨 있는지를 반복적으로 확인
* (카운팅)세마포  
  : 임계 구역 앞에서 멈춤 신호를 받으면 잠기 기다리고, 신호를 받으면 임계 구역 진입
  - 더 일반화된 방식의 동기화 도구
  - 공유 자원이 여러 개 있는 경우에도 적용 가능
  - 임계 구역에 진입할 수 있는 프로세스의 개수: 전역 변수 S
  - 임계 구역에 들어가도 되는지, 기다려야할지 알려줌: wait 함수
  - 임계 구역 앞에서 기다리는 프로세스에 가도 좋다고 신호를 줌: signal 함수  
    ![image](https://github.com/a0lim-java/cs/assets/104348646/7f87f840-60ae-4046-9b1c-3465d4205672)  
    ![image](https://github.com/a0lim-java/cs/assets/104348646/1e1c3357-76e1-46c8-b8fc-464befc06f54)  
  - 바쁜 대기의 해결방법
    + 사용할 수 있는 자원이 없을 경우, 대기 상태로 만듦(해당 프로세스의 PCB를 대기 큐에 삽입)
    + 사용할 수 있는 자원이 생겼을 경우, 준비 상태로 만듦(해당 프로세스의 PCB를 대기 큐에서 꺼내 준비 큐에 삽입)
      ![image](https://github.com/a0lim-java/cs/assets/104348646/80dc1174-fad7-4833-a6ba-adc328f240d5)  
  - 실행 순서 동기화
    + 세마포의 변수 S를 0으로 둠
    + 먼저 실행할 프로세스 뒤에 signal 함수를 붙임
    + 다음에 실행할 프로세스 앞에 wait 함수를 붙임
* 모니터
  - 상호 배제를 위한 동기화
    + 인터페이스를 위한 큐
    + 공유자원에 접근하고자 하는 프로세스를 큐에 삽입
    + 큐에 삽입된 순서대로 (한 번에 하나의 프로세스만) 공유 자원 이용
      ![image](https://github.com/a0lim-java/cs/assets/104348646/68951a04-14b8-4caa-8ccf-ffb67b7ecd74)  
  - 실행 순서 제어를 위한 동기화
    + 조건 변수(contition variable) 이용
      : 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수
        ![image](https://github.com/a0lim-java/cs/assets/104348646/041f242f-2d99-4cd3-a7ce-54e2b38c38a6)
        + 조건변수.wait(): 대기 상태로 변경, 조건 변수에 대한 큐에 삽입
          ![image](https://github.com/a0lim-java/cs/assets/104348646/cb76875b-1785-41ee-8a56-94b4f1285c5d)  
        + 조건변수.signal(): wait()로 대기 상태에 접어든 조건변수를 실행 상태로 변경
          ![image](https://github.com/a0lim-java/cs/assets/104348646/01851780-c398-4646-bd51-06340d3fa681)
  - 모니터 내의 프로세스(둘 중 하나 선택)
    1. wait()를 호출했던 프로세스는 signal()을 호출한 프로세스가 모니터를 떠난 뒤에 수행을 재개
    2. signal()을 호출한 프로세스의 실행을 일시 중단하고, 자신이 실행된 뒤 다시 signal()을 호출한 프로세스의 수행을 재개
